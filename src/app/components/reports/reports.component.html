<div style="padding:0.7em; background-color: #39623f !important;
                box-shadow: 0 4px 2px -2px rgba(0, 0, 0, 0.2); border: none !important;">
    <h5 style="font-weight: bold;font-family: auto;text-align: left;color: #fff;">Expense Tracker (Reports)</h5>
    <div class="row">
        <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
            <div style="text-align: center;margin-top:1em" class="row">
                <div class="col-5">
                    <select class="form-select" formControlName="filterMonth">
                        <option *ngFor="let month of months" [ngValue]="month">
                            {{month}}</option>
                    </select>
                </div>
                <div class="col-5">
                    <select class="form-select" formControlName="filterYear">
                        <option *ngFor="let year of years" [ngValue]="year">
                            {{year}}</option>
                    </select>
                </div>
                <div class="col-2">
                    <button type="submit" class="btn" style="background: #6d9773;"><i class="fa fa-search">
                            <span style="margin-left:5px"></span></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="container row" style="margin-top: 0.5em !important;margin: auto;">
    <button class="col-3 reportBtn" (click)="showReport('overview')"
        [ngStyle]="{'background': overviewFlag ? '#fff':'#6d9773', 'color': overviewFlag ? '#6d9773':'#fff', 'border-left': overviewFlag ? '1px solid #6d9773':'1px solid #fff'}">
        Overview
    </button>
    <button class="col-3 reportBtn" (click)="showReport('monthly')"
        [ngStyle]="{'background': monthlyFlag ? '#fff':'#6d9773', 'color': monthlyFlag ? '#6d9773':'#fff'}">
        Monthly
    </button>
    <button class="col-3 reportBtn" (click)="showReport('target')"
        [ngStyle]="{'background': targetFlag ? '#fff':'#6d9773', 'color': targetFlag ? '#6d9773':'#fff'}">
        Targets
    </button>
    <button class="col-3 reportBtn" (click)="showReport('trend')"
        [ngStyle]="{'background': trendFlag ? '#fff':'#6d9773', 'color': trendFlag ? '#6d9773':'#fff', 'border-right': trendFlag ? '1px solid #6d9773':'1px solid #fff'}">
        Trends
    </button>
</div>

<div *ngIf="overviewFlag" style="margin-top: 5em;" class="container">
    <div class="card"
        style="padding:0.7em;padding-top:1em;color:#fff;text-align: center;background: linear-gradient(118deg,#39623f,#7aa892)">
        <h4>Total Savings</h4>
        <h1 [ngStyle]="{'color': overview.totalDeviation > 0 ? '#8cff8c':'red'}">{{overview.totalDeviation|
            number:'1.2-2'}} د.إ</h1>
        <div class="card-body row">
            <div class="col-6" style="text-align: left;">
                <h4>Income</h4>
                <h5 [ngStyle]="{'color': overview.totalDeviation > 0 ? '#8cff8c':'red'}">{{overview.totalBudget|
                    number:'1.2-2'}} د.إ</h5>
            </div>
            <div class="col-6" style="text-align: right;">
                <h4>Expense</h4>
                <h5 [ngStyle]="{'color': overview.totalDeviation > 0 ? '#8cff8c':'red'}">{{overview.totalExpense|
                    number:'1.2-2'}} د.إ</h5>
            </div>
        </div>
    </div>
</div>

<div *ngIf="monthlyFlag" class="table-container" style="margin-left:0.1em;margin-right:0.1em">
    <div *ngFor="let group of groupedDataArray" style="padding:0.5em; margin:0.3em;margin-bottom: 1em;">
        <h4 style="color: #6d9773; ">{{ group.parent}}</h4>
        <div *ngFor="let item of group.items">
            <button class="row" (click)="openDialog(item.category, 'fetch-monthly-details', 100, 100)"
                style="width: -webkit-fill-available;padding-top: 0.5em;border: none;background-color: #eceae875; border-radius: 10px;"
                [ngStyle]="{'margin-bottom': group.items.length > 0 ? '0.3em': '0px'}">
                <div class="col-6" style="text-align: left;">
                    <h5 style="color: #6d9773">{{item.category}}</h5>
                    <h6 style="margin-bottom:0; color:dimgrey;">{{item.budget | number:'1.2-2'}}
                        <small style="font-size: 0.475em">AED</small>
                    </h6>
                </div>
                <div class="col-6" style="text-align: right;">
                    <h6 [ngStyle]="{'color': item.budget >= item.expense ? 'dimgrey':  'red'}">
                        {{item.expense | number:'1.2-2'}}
                        <small style="font-size: 0.475em">AED</small>
                    </h6>
                    <h5 [ngStyle]="{'color': item.deviate >= 0 ? '#6d9773':  'red'}">
                        {{item.deviate | number:'1.2-2'}}
                        <small style="font-size: 0.475em">AED</small>
                    </h5>
                </div>
            </button>
        </div>
    </div>

    <!-- <table class="table table-striped table-responsive table-bordered" style="background: none;">
        <thead>
            <tr>
                <th style="width:20%">Parent</th>
                <th style="width:20%">Category</th>
                <th style="width:18%">Budget</th>
                <th style="width:20%">Expense</th>
                <td style="width:20%">Deviation</td>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let monthlyView of responseList; let i=index">
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">{{monthlyView.parent}}
                </td>
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">
                    <a style="text-decoration: underline;cursor: pointer;"
                        (click)="openDialog(monthlyView.category, 'fetch-monthly-details', 100, 100)">{{monthlyView.category}}</a>
                </td>
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">{{monthlyView.budget}}
                </td>
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">{{monthlyView.expense}}
                </td>
                <td [ngStyle]="{'color': monthlyView.deviate == 0 ? 'black': (monthlyView.deviate < 0) ? 'red' : 'green',
                    'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">
                    {{monthlyView.deviate}}
                </td>
            </tr>
            <tr>
                <td colspan="2" style="background-color: #6d9773 !important;font-weight: bold;">Total</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;">{{monthlyBudgetTotal}}</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;">{{monthlyExpenseTotal |
                    number:'1.2-2'}}</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;"
                    [ngStyle]="{'color': monthlyDeviateTotal == 0 ? 'black': (monthlyDeviateTotal < 0) ? 'red' : 'green'}">
                    {{monthlyDeviateTotal | number:'1.2-2'}}</td>
            </tr>
        </tbody>
    </table> -->
</div>

<div *ngIf="targetFlag" class="table-container" style="padding-top:1em">
    <div *ngFor="let item of responseList" style="padding:0.2em; margin:auto;width:100%;">
        <button class="row" (click)="openDialog(item.parent, 'fetch-parent-details', 100, 100)"
            style="width: 100%;padding-top: 0.5em;border: none;background-color: #eceae875; border-radius: 10px;margin:auto"
            [ngStyle]="{'margin-bottom': responseList.length > 0 ? '0.3em': '0px'}">
            <div class="col-6" style="text-align: left;">
                <h5 style="color: #6d9773">{{item.parent}}</h5>
                <h6 style="margin-bottom:0; color:dimgrey;">{{item.budget | number:'1.2-2'}}
                    <small style="font-size: 0.475em">AED</small>
                </h6>
            </div>
            <div class="col-6" style="text-align: right;">
                <h6 [ngStyle]="{'color': item.expense === 0 || item.expense > item.budget ? 'red':  'dimgrey'}">
                    {{item.expense | number:'1.2-2'}}
                    <small style="font-size: 0.475em">AED</small>
                </h6>
                <h5 [ngStyle]="{'color': item.deviate >= 0 ? '#6d9773':  'red'}">
                    {{item.deviate | number:'1.2-2'}}
                    <small style="font-size: 0.475em">AED</small>
                </h5>
            </div>
        </button>
    </div>
    <!--     
    <table class="table table-striped table-responsive table-bordered" style="background: none;">
        <thead>
            <tr>
                <th style="width:30%">Category</th>
                <th style="width:30%">Budget</th>
                <th style="width:30%">Expense</th>
                <td style="width:20%">Deviation</td>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let targetView of responseList; let i=index">
                <td>
                    <a style="text-decoration: underline;cursor: pointer;"
                        (click)="openDialog(targetView.parent, 'fetch-parent-details', 100, 100)">{{targetView.parent}}</a>
                </td>
                <td>{{targetView.budget}}</td>
                <td>{{targetView.expense}}</td>
                <td
                    [ngStyle]="{'color': targetView.deviate == 0 ? 'black': (targetView.deviate < 0) ? 'red' : 'green'}">
                    {{targetView.deviate}}
                </td>
            </tr>
            <tr>
                <td style="background-color: #6d9773 !important;font-weight: bold;">Total</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;">{{targetBudgetTotal |
                    number:'1.2-2'}}</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;">{{targetExpenseTotal |
                    number:'1.2-2'}}</td>
                <td style="background-color: #6d9773 !important;font-weight: bold;"
                    [ngStyle]="{'color': targetDeviateTotal == 0 ? 'black': (targetDeviateTotal < 0) ? 'red' : 'green'}">
                    {{targetDeviateTotal | number:'1.2-2'}}</td>
            </tr>
        </tbody>
    </table> -->
</div>


<div *ngIf="trendFlag" class="table-container">
    <table class="table table-striped table-responsive table-bordered" style="background: none;">
        <thead>
            <tr>

                <th style="width:20%">Month</th>
                <th style="width:20%">Budget</th>
                <th style="width:18%">Expense</th>
                <th style="width:20%">Deviate</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let monthlyView of responseList; let i=index">
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">{{monthlyView.month}}
                </td>
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">
                    {{monthlyView.totalBudget | number:'1.2-2'}}</td>
                <td [ngStyle]="{'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">
                    {{monthlyView.totalExpense | number:'1.2-2'}}</td>
                <td [ngStyle]="{'color': monthlyView.deviate == 0 ? 'black': (monthlyView.deviate < 0) ? 'red' : 'green',
                    'background-color': monthlyView.deviate == 0 ? '#fafacd':  ''}">
                    {{monthlyView.deviate | number:'1.2-2'}}
                </td>
            </tr>
        </tbody>
    </table>
</div>